# SPDX-FileCopyrightText: 2023-2024 Helmholtz-Zentrum hereon GmbH
# SPDX-License-Identifier: CC0-1.0
# SPDX-FileContributor: Carsten Lemmen <carsten.lemmen@hereon.de>

readthedocs:
  image: alpine:latest
  stage: deploy
  before_script:
    - apk add curl rsync
  script:
    - rsync --ignore-errors ./netlogo/results/*png ./doc/mkdocs/assets/
    - rsync --ignore-errors ./doc/odd/paper.md ./doc/mkdocs/odd.md
    - 'curl -X POST -H "Authorization: Token ${RTD_TOKEN}" https://readthedocs.org/api/v3/projects/viable-north-sea/versions/latest/builds/'
  rules:
    # Only run the job on the default branch and not in forks.
    #- if: $CI_COMMIT_BRANCH == ${CI_DEFAULT_BRANCH}
  needs:
    - rtd-maps
  allow_failure: true

rtd-maps:
  image: comses/netlogo
  stage: deploy
  script:
    - echo "Trying to run in working directory and headless mode"
    - echo "Java HOME is ${JAVA_HOME}"
    - cd ${CI_PROJECT_DIR}/netlogo
    - sed  -i 's/^NetLogo 6..../NetLogo 6.2.2/g' vinos.nlogo
    - 'bash /opt/netlogo/netlogo-headless.sh --model ./vinos.nlogo --setup-file ./behavior/rtd-maps.xml
      --experiment "rtd-maps" --table - '
  artifacts:
    paths:
      - "./netlogo/results/*png"
      - "./doc/odd/paper.md"
  needs: []
  allow_failure: true
  interruptible: true
  timeout: 40 min
